import{__rest}from"./tsc/tslib.js";import React,{Children,createElement,isValidElement,useContext,useEffect}from"../../../esm.sh/react.js";import{RendererContext}from"./context.js";import util from"./util.js";export const serverStyles=new Map;export default function Head(e){const t=useContext(RendererContext);if(window.Deno){parse(e.children).forEach(({type:e,props:n},r)=>t.cache.headElements.set(r,{type:e,props:n}))}useEffect(()=>{const t=window.document;const n=parse(e.children);const r=[];if(n.size>0){let e=t.querySelector("meta[charset]");if(!e){e=t.createElement("meta");e.setAttribute("charset","utf-8");t.head.prepend(e)}const i=t.createElement("meta");if(e.nextElementSibling){t.head.insertBefore(i,e.nextElementSibling)}else{t.head.appendChild(i)}n.forEach(({type:e,props:n})=>{if(e==="script"){return}const a=t.createElement(e);Object.keys(n).forEach(e=>{const t=n[e];if(e==="children"){if(util.isNEString(t)){a.innerText=t}else if(util.isNEArray(t)){a.innerText=t.join("")}}else{a.setAttribute(e,String(t||""))}});t.head.insertBefore(a,i);r.push(a)});t.head.removeChild(i)}return()=>{r.forEach(e=>t.head.removeChild(e))}},[e.children]);return null}export function Scripts(e){const t=useContext(RendererContext);if(window.Deno){parse(e.children).forEach(({type:e,props:n},r)=>{if(e==="script"){t.cache.scriptsElements.set(r,{type:e,props:n})}})}return null}export function SEO(e){const{title:t,description:n,keywords:r,url:i,image:a,twitter:s}=e;return createElement(Head,undefined,t&&createElement("title",undefined,t),n&&createElement("meta",{name:"description",content:n}),r&&createElement("meta",{name:"keywords",content:util.isArray(r)?r.join(","):r}),t&&createElement("meta",{name:"og:title",content:t}),n&&createElement("meta",{name:"og:description",content:n}),t&&createElement("meta",{name:"twitter:title",content:t}),n&&createElement("meta",{name:"twitter:description",content:n}),i&&createElement("meta",{name:"og:url",content:i}),a&&createElement("meta",{name:"og:image",content:a}),a&&createElement("meta",{name:"twitter:image",content:a}),a&&createElement("meta",{name:"twitter:card",content:(s===null||s===void 0?void 0:s.card)||"summary_large_image"}),(s===null||s===void 0?void 0:s.site)&&createElement("meta",{name:"twitter:site",content:s.site}),(s===null||s===void 0?void 0:s.creator)&&createElement("meta",{name:"twitter:creator",content:s.creator}))}export function Viewport(e){const t=Object.entries(e).map(([e,t])=>{e=e.replace(/[A-Z]/g,e=>"-"+e.toLowerCase());return`${e}=${t}`}).join(",");return createElement(Head,undefined,t&&createElement("meta",{name:"viewport",content:t}))}export function applyCSS(e,t,n=false){if(window.Deno){serverStyles.set(e,{css:t,asLink:n})}else{const{document:r}=window;const i=r.createElement(n?"link":"style");const a=Array.from(r.head.children).filter(t=>t.getAttribute("data-module-id")===e);if(n){i.rel="stylesheet";i.href=t}else{i.type="text/css";i.appendChild(r.createTextNode(t))}i.setAttribute("data-module-id",e);r.head.appendChild(i);if(a.length>0){if(n){i.addEventListener("load",()=>{a.forEach(e=>r.head.removeChild(e))})}else{setTimeout(()=>{a.forEach(e=>r.head.removeChild(e))},0)}}}}function parse(e,t=new Map){Children.forEach(e,e=>{if(!isValidElement(e)){return}const{type:n,props:r}=e;switch(n){case React.Fragment:parse(r.children,t);break;case SEO:case Viewport:parse(n(r).props.children,t);break;case"base":case"title":case"meta":case"link":case"style":case"script":case"no-script":{let e=n;if(n==="meta"){const t=Object.keys(r).map(e=>e.toLowerCase());if(t.includes("charset")){return}if(t.includes("name")){e+=`[name=${JSON.stringify(r["name"])}]`}else if(t.includes("property")){e+=`[property=${JSON.stringify(r["property"])}]`}else if(t.includes("http-equiv")){e+=`[http-equiv=${JSON.stringify(r["http-equiv"])}]`}else{e+=Object.keys(r).filter(e=>!/^content|children$/i.test(e)).map(e=>`[${e.toLowerCase()}=${JSON.stringify(r[e])}]`).join("")}}else if(n!=="title"){e+="-"+(t.size+1)}if(["base","meta","link"].includes(n)&&"children"in r){const{children:i}=r,a=__rest(r,["children"]);t.set(e,{type:n,props:a})}else{t.set(e,{type:n,props:r})}}break}});return t}