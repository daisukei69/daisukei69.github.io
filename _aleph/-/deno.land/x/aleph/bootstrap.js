import{__awaiter}from"./tsc/tslib.js";import React from"../../../esm.sh/react.js";import{hydrate,render}from"../../../esm.sh/react-dom.js";import{ALEPH,getModuleImportUrl}from"./aleph.js";import{Routing}from"./routing.js";import util,{reHttp}from"./util.js";export default function bootstrap({routes:e,baseUrl:t,defaultLocale:o,locales:r,preloadModules:i,renderMode:s}){return __awaiter(this,void 0,void 0,(function*(){const{document:n}=window;const a=n.querySelector("main");const d=n.querySelector("#ssr-data");const l={};const c=new Routing(e,t,o,r);const[m,p]=c.createRouter();const u=p.map(({id:e})=>({id:e}));const f=[...i,...p].map(e=>__awaiter(this,void 0,void 0,(function*(){const{default:o}=yield import(getModuleImportUrl(t,e));if(e.deps){for(const o of e.deps.filter(({isStyle:e})=>!!e)){yield import(getModuleImportUrl(t,{id:util.ensureExt(o.url.replace(reHttp,"/-/"),".js"),hash:o.hash}))}}switch(e.id){case"/app.js":l["App"]=o;break;case"/404.js":l["E404"]=o;break;default:const t=u.find(t=>t.id===e.id);if(t){t.Component=o}break}})));yield Promise.all(f);if(d){const e=JSON.parse(d.innerText);for(const t in e){Object.assign(window,{[`useDeno://${m.pathname}?${m.query.toString()}#${t}`]:e[t]})}}const h=React.createElement(ALEPH,{initial:{routing:c,url:m,components:l,pageComponentTree:u}});if(s==="ssr"){hydrate(h,a)}else{render(h,a)}setTimeout(()=>{Array.from(n.head.children).forEach(e=>{if(e.hasAttribute("ssr")){n.head.removeChild(e)}})},0)}))}