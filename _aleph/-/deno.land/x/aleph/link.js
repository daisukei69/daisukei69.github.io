import{__rest}from"./tsc/tslib.js";import React,{Children,cloneElement,isValidElement,useCallback,useEffect,useMemo}from"../../../esm.sh/react.js";import{redirect}from"./aleph.js";import events from"./events.js";import{useRouter}from"./hooks.js";import util from"./util.js";const prefetchedPageModules=new Set;export default function Link(e){const{to:t,replace:s=false,prefetch:i=false,className:n,style:l,children:a}=e;const{pathname:r,query:o}=useRouter();const c=useMemo(()=>[r,o.toString()].filter(Boolean).join("?"),[r,o]);const u=useMemo(()=>{if(util.isHttpUrl(t)){return t}let[e,s]=util.splitBy(t,"?");if(e.startsWith("/")){e=util.cleanPath(e)}else{e=util.cleanPath(r+"/"+e)}return[e,s].filter(Boolean).join("?")},[r,t]);const f=useCallback(()=>{if(!util.isHttpUrl(u)&&u!==c&&!prefetchedPageModules.has(u)){events.emit("fetch-page-module",{href:u});prefetchedPageModules.add(u)}},[u,c]);const m=useCallback(e=>{e.preventDefault();if(u!==c){redirect(u,s)}},[u,c,s]);useEffect(()=>{if(i){f()}},[i,f]);if(Children.count(a)===1){const e=Children.toArray(a)[0];if(isValidElement(e)&&e.type==="a"){const{props:t}=e;return cloneElement(e,Object.assign(Object.assign({},t),{className:[n,t.className].filter(util.isNEString).join(" ")||undefined,style:Object.assign({},l,t.style),href:u,"aria-current":t["aria-current"]||"page",onClick:e=>{if(util.isFunction(t.onClick)){t.onClick(e)}if(!e.defaultPrevented){m(e)}},onMouseEnter:e=>{if(util.isFunction(t.onMouseEnter)){t.onMouseEnter(e)}if(!e.defaultPrevented){f()}}}))}}return React.createElement("a",{className:n,style:l,href:u,onClick:m,onMouseEnter:f,"aria-current":"page"},a)}export function NavLink(e){var t;const{activeClassName:s="active",activeStyle:i,to:n}=e,l=__rest(e,["activeClassName","activeStyle","to"]);const{pathname:a}=useRouter();const r=useMemo(()=>{if(util.isHttpUrl(n)){return n}let[e]=util.splitBy(n,"?");if(e.startsWith("/")){e=util.cleanPath(e)}else{e=util.cleanPath(a+"/"+e)}return e},[a,n]);if(a===r){return React.createElement(Link,Object.assign(Object.assign({},l),{to:n,className:[(t=l.className)===null||t===void 0?void 0:t.trim(),s.trim()].filter(Boolean).join(" "),style:Object.assign({},l.style,i)}))}return React.createElement(Link,Object.assign(Object.assign({},l),{to:n}))}